---
title: "WidgetsFlutterBindingã‹ã‚‰è¦‹ã‚‹mixinã®ä½¿ã„æ–¹"
emoji: "ğŸœ"
type: "tech"
topics: ["flutter", "mixin"]
published: true
published_at: "2021-11-25 18:17"
---

Dartã«ã¯mixinã¨ã„ã†å¤šé‡ç¶™æ‰¿ã‚’å®Ÿç¾ã™ã‚‹ä»•çµ„ã¿ãŒã‚ã‚‹ã®ã§ã™ãŒã€ç§ã¯ä½¿ã„ã©ã“ã‚ã¨ã„ã†ã®ãŒã„ã¾ã„ã¡åˆ†ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚
ã—ã‹ã—Flutter Frameworkã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã„ãã¨ã€ãã®å…¥å£ã§ã‚ã‚‹`WidgetsFlutterBinding`ã§æ€ã„åˆ‡ã‚ŠmixinãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ãã®ä½¿ã„æ–¹ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ã§mixinåˆ©ç”¨ã®æ„ç¾©ã‚’è€ƒãˆã¾ã™ã€‚

# WidgetsFlutterBinding is ä½•

Flutterã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã¨ãã€`main`é–¢æ•°å†…ã§å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã®ãŒ`runApp()`ã§ã™ã€‚

```dart
void main() {
  runApp(MyApp());
}
```

ãã®`runApp()`ã®å®Ÿè£…ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```dart
void runApp(Widget app) {
  WidgetsFlutterBinding.ensureInitialized()
    ..scheduleAttachRootWidget(app)
    ..scheduleWarmUpFrame();
}
```

https://github.com/flutter/flutter/blob/3595343e20/packages/flutter/lib/src/widgets/binding.dart#L1034

æ—©é€Ÿå‡ºã¦ãã¾ã—ãŸã­ã€‚`WidgetsFlutterBinding.ensureInitialized()`ã¨ã„ã†ã®ãŒ`WidgetsFlutterBinding`ã®åˆæœŸåŒ–å‡¦ç†ã‚’ã—ã¦ã„ã¾ã™ã€‚

`WidgetsFlutterBinding`ã¯Flutter Frameworkã¨Flutter Engineã‚’ã¤ãªã’ã‚‹å½¹å‰²ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ãƒ„ãƒªãƒ¼ã‚’æ§‹ç¯‰ã—ãŸã‚Šãƒ¦ãƒ¼ã‚¶å…¥åŠ›ã‚’å‡¦ç†ã—ãŸã‚Šãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å‘¼ã³å‡ºã—ãŸã‚Šã¨Flutterã®é‡è¦ãªéƒ¨åˆ†ã‚’è‰²ã€…ã¨å—ã‘æŒã£ã¦ã„ã¾ã™ã€‚
Flutterã®æ©Ÿèƒ½ã‚’`runApp()`ä»¥å‰ã«ä½¿ã„ãŸã„å ´åˆã«ã¯`WidgetsFlutterBinding.ensureInitialized()`ã‚’å‘¼ã³å‡ºã™ã¨ã„ã„ã€ã¨ã„ã†æŠ€ãŒã‚ã‚‹ãŸã‚ãªã‚“ã¨ãªãåå‰ã‚’çŸ¥ã£ã¦ã„ã‚‹äººã‚‚ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

# WidgetsFlutterBindingã®å®Ÿè£…

å¤šãã®æ©Ÿèƒ½ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã§ã™ãŒã€`WidgetsFlutterBinding`ã®å®Ÿè£…è‡ªä½“ã¯ä»¥ä¸‹ã ã‘ã§ã™ã€‚

```dart
//...
class WidgetsFlutterBinding extends BindingBase with GestureBinding, SchedulerBinding, ServicesBinding, PaintingBinding, SemanticsBinding, RendererBinding, WidgetsBinding {
  //...
  static WidgetsBinding ensureInitialized() {
    if (WidgetsBinding.instance == null)
      WidgetsFlutterBinding();
    return WidgetsBinding.instance!;
  }
}
```

https://github.com/flutter/flutter/blob/f9c4b227213fe468bf221d2413d575cd446069dd/packages/flutter/lib/src/widgets/binding.dart#L1237

è¦ã¯

- ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹
  - `BindingBase`
- ãƒŸãƒƒã‚¯ã‚¹ã‚¤ãƒ³
  - `GestureBinding`
  - `SchedulerBinding`
  - `ServicesBinding`
  - `PaintingBinding`
  - `SemanticsBinding`
  - `RendererBinding`
  - `WidgetsBinding`

ãŒè£ã«æ½œã‚“ã§ã„ã‚‹ã“ã¨ãŒè¦‹ã¦å–ã‚Œã¾ã™ã€‚ç¶™æ‰¿ã¨mixinã‚’ä½¿ã£ã¦ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€ã¾ãšã¯mixinã§ãªã«ãŒã§ãã‚‹ã®ã‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

# mixinã¨ã¯ï¼Ÿ

mixinã¯ä¸€éƒ¨ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ä»•çµ„ã¿ã§ã€å¤šé‡ç¶™æ‰¿ã®ã‚ˆã†ãªã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚withå¥ã‚’ç”¨ã„ã¦1ã¤ã®ã‚¯ãƒ©ã‚¹ã«è¤‡æ•°ã®mixinã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
è©³ã—ãã¯ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã®ã“ã¨ã€‚

https://github.com/dart-lang/language/blob/master/accepted/2.1/super-mixins/feature-specification.md

https://ntaoo.hatenablog.com/entry/2018/12/02/192827

https://spec.dart.dev/DartLangSpecDraft.pdf

## å®£è¨€

mixinã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æ–‡ã§å®£è¨€ã§ãã¾ã™ã€‚

```dart
mixin M1 on I1, I2 {
  void field1() {
  }
  
  int field2 = 0;
}
```

ã“ã‚Œã§M1ã¨ã„ã†mixin(ã¨interface)ãŒå®šç¾©ã•ã‚Œã¾ã™ã€‚Dart2.xã§ã¯ã¾ã ã‚¯ãƒ©ã‚¹å®£è¨€ã‹ã‚‰ã‚‚mixinãŒå®šç¾©ã•ã‚Œã¾ã™ãŒã€ã“ã¡ã‚‰ã¯å°†æ¥çš„ã«å‰Šé™¤ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
`on I1, I2`ã®ã‚ˆã†ã«mixinå®£è¨€ã§onä»¥é™ã«ã‚¯ãƒ©ã‚¹ã‚’1å€‹ä»¥ä¸ŠæŒ‡å®šã™ã‚‹ã“ã¨ã§M1ã«å¯¾ã—ã¦**ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¶ç´„**ã‚’ä»˜ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`I1, I2`ã¯**required superinterface**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚ã¾ãŸ`on`ã‚’çœç•¥ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã€ãã®å ´åˆã¯`on Object`ã¨æ›¸ã„ãŸã“ã¨ã¨åŒã˜æ‰±ã„ã¨ãªã‚Šã¾ã™ã€‚

```dart
mixin M2 { }

// ä¸Šã¨åŒã˜æ„å‘³ã«ãªã‚‹
mixin M2 on Object { }
```

mixinå®£è¨€M1ã‚’interfaceã¨ã—ã¦åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªinterfaceã«ãªã‚‹ã‚ˆã†ã«æŒ¯ã‚‹èˆã„ã¾ã™ã€‚

```dart
//ä»¥ä¸‹ãŒmixinã§å®£è¨€ã—ãŸã‚‚ã®ã¨åŒç­‰
abstract class M1$super implements I1, I2 { }
abstract class M1 extends M1$super { body' }

//ã“ã®ã‚ˆã†ã«ä½¿ãˆã‚‹
class C implements M1 {
   ...
}
```

ã“ã“ã‹ã‚‰ã€mixinã®**required superinterface**ã¯ã€mixinã®é©ç”¨å…ˆã«å®Ÿè£…ã‚’æ±‚ã‚ã‚‹implementsçš„ãªä½œç”¨ã‚’æŒã¤ã“ã¨ãŒè¨€ãˆã¾ã™ã€‚mixinå†…ã§å®Ÿè£…ãŒè¦æ±‚ã•ã‚Œãªã„ã®ã¯mixinè‡ªä½“ãŒå®Ÿè³ªçš„ã«æŠ½è±¡ã¨ã—ã¦æŒ¯ã‚‹èˆã†ãŸã‚ã§ã™ã€‚mixinè‡ªä½“ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã™ã‚‹ã“ã¨ã¯ã§ããšã€å¿…ãšå®Ÿè£…ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ã¨ã¨ã‚‚ã«ä½¿ã‚ã‚Œã¾ã™ã€‚ã—ã‹ã—mixinã¯å®Ÿéš›ã‚¯ãƒ©ã‚¹ã¨åŒç­‰ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æŒã¤ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€å®Œå…¨ã«æŠ½è±¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

## ã‚¯ãƒ©ã‚¹ã¸ã®é©ç”¨

ã‚¯ãƒ©ã‚¹ã¸ã®é©ç”¨ã¯withå¥ã‚’ä½¿ã£ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

```dart
class Base { }

mixin M3 on Base { }

class C extends Base with M3 { }
```

ã“ã®å ´åˆã€Baseã«å¯¾ã—ã¦M3ã‚’mixinã—ãŸã‚‚ã®ã‚’CãŒç¶™æ‰¿ã—ã¦ã„ã‚‹ã¨ã„ã†æµã‚Œã«ãªã£ã¦ã„ã¾ã™ã€‚
`Base with M3`ã®éƒ¨åˆ†ã§ä½œã‚‰ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚’**mixin application**ã¨å‘¼ã³ã¾ã™ã€‚`extends`ã‚’çœã„ã¦`class C with M`ã®ã‚ˆã†ã«æ›¸ãã“ã¨ã‚‚å¯èƒ½ã§ã™ãŒã€ã“ã‚Œã¯`class C extends Object with M`ã¨åŒã˜æ‰±ã„ã§ã‚ã‚Šã€Mã®mixinå…ˆã¯Cã§ã¯ãªãObjectã§ã™ã€‚
> mixinã¯å®Ÿè³ªæŠ½è±¡ã§ã‚ã‚‹ã¨è¨€ã„ã¾ã—ãŸãŒã€**required superinterface**ãŒãªã‘ã‚Œã°mixinè‡ªä½“ã«æœªå®Ÿè£…ã¯å­˜åœ¨ã—ãªã„ãŸã‚ã©ã®ã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦ã‚‚mixinã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

mixinãŒonå¥ã‚’æŒã¤ã€ã¤ã¾ã‚Š**required superinterface**ã‚’æŒã¤å ´åˆã¯mixinå…ˆãŒãã®ã™ã¹ã¦ã‚’å®Ÿè£…ã—ã¦ã„ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ã¤ã¾ã‚Šä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

```dart
class Base2 { }

// on Object
mixin M4 { }

//ã‚¯ãƒ©ã‚¹ã¯Objectã‚’ç¶™æ‰¿ã—ã¦ã„ã‚‹ã®ã§å•é¡Œãªã—
class C1 extends Base2 with M4 { }

mixin M5 on I1 { }

// error: Base2ã«I1ã®å®Ÿè£…ãŒãªã„ãŸã‚
class C2 extends Base2 with M5 { }

class Base3 implements I1 { }

// Base3ã¯I1ã®å®Ÿè£…ã‚’ã‚‚ã¤ãŸã‚OK
class C3 extends Base3 with M5 { }

// error: C4ãŒI1ã®å®Ÿè£…ã‚’æŒã£ã¦ã„ã¦ã‚‚é–¢ä¿‚ãªã„ã®ã§ã ã‚
class C4 extends Base2 with M5 implements I1 { }

mixin M6 on I1, I2 { }

class Base4 extends Base3 implements I2 { }

// Base4ã¯I1ã¨I2ã©ã¡ã‚‰ã®å®Ÿè£…ã‚‚æŒã£ã¦ã„ã‚‹ã®ã§OK
class C5 extends Base4 with M6 { }
```

withå¥ã«è¤‡æ•°ã®mixinã‚’æ¸¡ã—ãŸå ´åˆ(`B with M1, M2`)ã¯ã€`B with M1`ã§ç”Ÿæˆã•ã‚ŒãŸæŠ½è±¡ã‚¯ãƒ©ã‚¹Xã«å¯¾ã—ã¦`X with M2`ãŒ**mixin application**ã«ãªã‚Šã¾ã™ã€‚é›‘ã«è¨€ãˆã°

```dart
B with M1, M2, M3
```

ã¯

```dart
((B with M1) with M2) with M3
```

ã®ã‚ˆã†ã«å·¦ã‹ã‚‰é †ã«è§£é‡ˆã•ã‚Œã¾ã™ã€‚

> å½“ç„¶å®Ÿéš›ã«ã“ã®ã‚ˆã†ãªæ›¸ãæ–¹ã¯ã§ãã¾ã›ã‚“ã€‚

withå¥ã¯é †åºã‚’æŒã¤ãŸã‚ã€ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¶ç´„ã§äº’ã„ã‚’åˆ¶ç´„ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

```dart
// error
mixin M1 on M2 { }
mixin M2 on M3 { }
mixin M3 on M1 { }
```



## ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—

onå¥ã«ã‚ˆã‚‹ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¶ç´„ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§ã€mixinå†…ã§ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

```dart
class Base5 {
  void field1() {
    print("in Base5");
  }
}

mixin M7 on Base5 {
  void field2() {
    super.field1();
  }
}
```

onå¥ã§æŒ‡å®šã•ã‚ŒãŸinterfaceã«å«ã¾ã‚Œã‚‹ãƒ¡ãƒ³ãƒã§ã‚ã‚Œã°å‘¼ã³å‡ºã›ã¾ã™ã€‚ã“ã®åˆ¶ç´„ã¯ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—å…ˆãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ãŒã€å®Ÿéš›ã®å‘¼ã³å‡ºã—ã®å„ªå…ˆé †ã¯**mixin application**ã®ç”Ÿæˆæ™‚ã«æ±ºã¾ã‚‹ãŸã‚ã€å¿…ãšã—ã‚‚onå¥ã«æ›¸ã„ãŸinterfaceã®ãƒ¡ãƒ³ãƒãŒé¸æŠã•ã‚Œã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚

```dart
mixin M8 {
  void field1() {
    print("in M8");
  }
}

// M7ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã®å¯¾è±¡ã¯`Base5 with M8`ã«ãªã‚‹ãŸã‚
// field1()ã¯M8ã§ä¸Šæ›¸ãã•ã‚Œã‚‹
class C extends Base5 with M8, M7 { }

C().field2(); // -> in M8
```

ã“ã®ãŸã‚mixinã§ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—å…ˆã¯mixinå®£è¨€ã ã‘ã§ã¯å®šã¾ã‚‰ãªã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã¡ã‚‡ã£ã¨èª­ã¿ã«ãã„ã§ã™ã­...

ã“ã“ã¾ã§ã®è©±ã‹ã‚‰**required superinterface**ã¯å®Ÿè³ªçš„ã«ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¶ç´„ã‚’ä»˜ã‘ã‚‹ã“ã¨ã¨mixinå†…ã§ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—ã‚’å®‰å…¨ã«ã™ã‚‹ã“ã¨ã®ã¿ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã¨è€ƒãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‚ˆã£ã¦ã‚¯ãƒ©ã‚¹ã®é–¢ä¿‚æ€§ã‚’è¦‹ãŸã„ã¨ãã«ã¯(ä½¿ã„ã¾ã‚ã—ã¦ã„ã‚‹ã®ã§ãªã‘ã‚Œã°)ç„¡è¦–ã—ã¦ã‚ˆã„ã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚

# WidgetsFlutterBindingã§ã®ä½¿ã‚ã‚Œæ–¹

æˆ»ã£ã¦`WidgetsFlutterBinding`ãŒã©ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ã®ã‹ã‚’è€ƒãˆãŸã„ã¨æ€ã„ã¾ã™ã€‚

onå¥ã¯ç„¡è¦–ã§ãã‚‹ã¨ã„ã†ã“ã¨ã€withå¥ä»¥ä¸‹ã¯`BindingBase`ã«é©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’è€ƒæ…®ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚

![WidgetsFlutterBindingã®æ§‹æˆ](https://storage.googleapis.com/zenn-user-upload/34816cb929deb5adc98b10e8.png)

withã¯ãã‚Œã‚ˆã‚Šä¸Šã®ã‹ãŸã¾ã‚Šã«å¯¾ã—ã¦é©ç”¨ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚onå¥ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹åˆ¶ç´„ã«ã‚ˆã‚Šwithå†…ã®mixinã®é †ç•ªãŒåˆ¶é™ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°`RendererBinding`ã¯`ServicesBinding`,`SchedulerBinding`,`GestureBinding`,`SemanticsBinding`ã‚’è¦æ±‚ã™ã‚‹ã®ã§ãã‚Œã‚‰ã‚ˆã‚Šå‰ã«é©ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

## åˆæœŸåŒ–å‡¦ç†

ã•ã¦ã€å®Ÿéš›ã«ã“ã®`WidgetsFlutterBinding`ãŒã©ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã®ã‹ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚ç‰¹å¾´çš„ãªã®ã¯åˆæœŸåŒ–æ™‚ã®å‡¦ç†ã§ã™ã€‚

`WidgetsFlutterBinding.ensureInitialized()`ãŒå‘¼ã°ã‚Œã‚‹ã¨ã€åˆã‚ã¦å‘¼ã³å‡ºã™å ´åˆã¯ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆã®ãŸã‚ã«[`WidgetsFlutterBinding()`](https://github.com/flutter/flutter/blob/f9c4b227213fe468bf221d2413d575cd446069dd/packages/flutter/lib/src/widgets/binding.dart#L1252)ã‚’å‘¼ã¶ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ã—ã‹ã—ã€`WidgetsFlutterBinding`ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å®£è¨€ã—ã¦ã„ã¾ã›ã‚“ã€‚

Dartã§ã¯ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å®£è¨€ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã€ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯å‘¼ã°ã‚Œã¾ã™ã€‚

```dart
class C extends S { }
class S {
  S() {
    print("in S");
  }
}

C(); // -> in S
```

ã‚ˆã£ã¦`BindingBase`ã®[ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿](https://github.com/flutter/flutter/blob/f9c4b227213fe468bf221d2413d575cd446069dd/packages/flutter/lib/src/foundation/binding.dart#L52)ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```dart
abstract class BindingBase {
  //...
  BindingBase() {
    //...
    initInstances();
    //...
  }
  //...
}
```

ä¸Šã®ã‚ˆã†ã«ãã®ä¸­ã§`initInstances()`ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€å•é¡Œã¯ã“ã‚ŒãŒä½•ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚ä¸€å¿œ`BindingBase.initInstances()`ã‚’è¦‹ã‚‹ã¨

```dart
  @protected
  @mustCallSuper
  void initInstances() {
    assert(!_debugInitialized);
    assert(() {
      _debugInitialized = true;
      return true;
    }());
  }
```

ã¨ã€å®Ÿè³ªä¸­èº«ã¯ç„¡ãã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—ã‚’è¦æ±‚ã—ã¦ã„ã‚‹ã“ã¨ã‹ã‚‰åˆ¥ã«å®Ÿè£…ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã—ã‹ã—ç¶™æ‰¿å…ˆã§ã‚ã‚‹`WidgetsFlutterBinding`ã¯ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ã‚¯ãƒ©ã‚¹ã¸ã®é©ç”¨ ã®éƒ¨åˆ†ã§ã‚‚è©±ã—ã¾ã—ãŸãŒã€mixinã¯withå¥ã§å…ƒã®ã‚¯ãƒ©ã‚¹ã‚’ä¸Šæ›¸ãã—ã¦ã„ãã¾ã™ã€‚ã‚ˆã£ã¦mixinã«å®Ÿè£…ãŒã‚ã‚Œã°ãã¡ã‚‰ãŒå‘¼ã°ã‚Œã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã«7ã¤å…¨ã¦ã®mixinãŒ`initInstances()`ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
ä¸Šæ›¸ãã—ã¦ã„ããŸã‚æœ€åˆã«å‘¼ã°ã‚Œã‚‹ã®ã¯withå¥ã®æœ€å¾Œã«ã‚ã‚‹`WidgetsBinding.initInstances()`ã§ã™ã€‚ãã‚Œã‚‰ã‚’è€ƒæ…®ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå‘¼ã³å‡ºã—é †åºã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

![initInstances()ã®å‘¼ã³å‡ºã—é †åº](https://storage.googleapis.com/zenn-user-upload/b2446ce77962541aef9c46c2.png)

ãã‚Œãã‚Œã®å®Ÿè£…ã§`super.initInstances()`ãŒå†’é ­ã§å‘¼ã°ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹é †åºã¯é€†é †ã«ãªã‚Šã¾ã™ã€‚

```dart
mixin WidgetsBinding {
  @override
  void initInstances() {
    super.initInstances();
    _instance = this;

    assert(() {
      _debugAddStackFilters();
      return true;
    }());

    // Initialization of [_buildOwner] has to be done after
    // [super.initInstances] is called, as it requires [ServicesBinding] to
    // properly setup the [defaultBinaryMessenger] instance.
    _buildOwner = BuildOwner();
    buildOwner!.onBuildScheduled = _handleBuildScheduled;
    window.onLocaleChanged = handleLocaleChanged;
    window.onAccessibilityFeaturesChanged = handleAccessibilityFeaturesChanged;
    SystemChannels.navigation.setMethodCallHandler(_handleNavigationInvocation);
    assert(() {
      FlutterErrorDetails.propertiesTransformers.add(debugTransformDebugCreator);
      return true;
    }());
  }
  //...
}
```

# ã¾ã¨ã‚
ã“ã“ã¾ã§mixinã®æ¦‚è¦ã¨`WidgetsFlutterBinding`ã§ã©ã®ã‚ˆã†ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã¦ãã¾ã—ãŸã€‚`WidgetsFlutterBinding`ã§ã¯ä¸»ã«ã€Œã‚¯ãƒ©ã‚¹æ©Ÿèƒ½ã®åˆ†å‰²ã€ã¨ã„ã†æ„å›³ã§mixinã‚’ã—ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ä¸¦åˆ—ãªæ©Ÿèƒ½ã‚’ã²ã¨ã¤ã®ã‚¯ãƒ©ã‚¹ã‹ã‚‰åˆ†å‰²ã™ã‚‹ã«ã¯Dartã®è¨€èªä»•æ§˜ã§ã¯mixinã—ã‹ã§ããªã„ã“ã¨ãªã®ã§é¸ã°ã‚ŒãŸã®ã ã¨æ€ã„ã¾ã™(C#ã¨ã‹ã ã¨partial classãŒè©²å½“ã™ã‚‹ã‹ãªï¼Ÿ)ã€‚

ã¾ãŸmixinã«ã¤ã„ã¦ã¯mixinã—ãŸå¾Œã®ã‚¹ãƒ¼ãƒ‘ãƒ¼å‘¼ã³å‡ºã—ã®æ±ºå®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯æ˜å¿«ã§ã‚ˆã„ã¨æ€ã†ã®ã§ã™ãŒã€mixinå˜ä½“ã ã‘ã ã¨ä½•ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã€ã¨ã„ã†ã®ã¯ã„ã•ã•ã‹èª­ã¿ã¥ã‚‰ã„ã¨æ„Ÿã˜ã¾ã™ã€‚ãã®ã‚ãŸã‚Šã¯IDEãƒ‘ãƒ¯ãƒ¼ã§ãªã‚“ã¨ã‹ã—ã¦ãã‚Œã€ãªã‚“ã§ã™ã‹ã­ã€‚
ãªã®ã§ã‚¯ãƒ©ã‚¹åˆ†å‰²ã®ç”¨é€”ã§mixinã‚’å€‹äººã§ä½¿ã†å ´åˆã¯ã€äº’ã„ã«ç‹¬ç«‹ãª(ä»–ã®mixinã®å‘¼ã³å‡ºã—ã‚’æŒãŸãªã„)ç¨‹åº¦ã§ä½¿ã†ã¨ã„ã†ã®ãŒå¯èª­æ€§ã‚’è€ƒãˆã‚‹ã¨ã‚ˆã„ã®ã‹ãªã¨æ€ã„ã¾ã™ã€‚

# å‚è€ƒ

https://medium.com/flutter-community/dart-what-are-mixins-3a72344011f3

https://github.com/dart-lang/language/blob/master/accepted/2.1/super-mixins/feature-specification.md

https://ntaoo.hatenablog.com/entry/2018/12/02/192827

https://spec.dart.dev/DartLangSpecDraft.pdf

https://qiita.com/kurun_pan/items/04f34a47cc8cee0fe542

https://api.flutter.dev/flutter/widgets/WidgetsFlutterBinding-class.html