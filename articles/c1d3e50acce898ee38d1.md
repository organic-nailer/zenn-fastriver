---
title: "Kotlin/JVMã§ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã—ãŸã„"
emoji: "ğŸ"
type: "tech"
topics: ["kotlin", "æ©Ÿæ¢°å­¦ç¿’", "jvm", "nd4j"]
published: true
published_at: "2020-10-23 01:10"
---

# å‹•æ©Ÿ
- æ©Ÿæ¢°å­¦ç¿’ã‚’å‹‰å¼·ã—ãŸã„
- ãŒã€Pythonã‚’æ›¸ããŸããªã„
- Kotlinã§æ›¸ããŸã„
- IntelliJã•ã‚“ã®è‚©ã«ä¹—ã‚ŠãŸã„

# ç›®æ¨™
åŸºç¤ã®åŸºç¤ã§ã‚ã‚‹ã€ãƒ™ã‚¯ãƒˆãƒ«ãƒ»è¡Œåˆ—è¨ˆç®—ã¨ã‚°ãƒ©ãƒ•è¡¨ç¤ºãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

# æ§‹æˆ
IntelliJ IDEA + Kotlin/JVM + Gradle + ND4J + lets-plot + batik

ç’°å¢ƒã¯Windows10ã§ã™

# æ§‹ç¯‰ã™ã‚‹

## Gradleã®è¨­å®š

ã¾ãšã€IDEAã§æ–°ã—ããƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã€‚Gradleã¨Kotlin/JVMã‚’ä½¿ã„ãŸã„ã®ã§ãã‚Œã‚‰ã‚’é¸æŠã—ã¦ä½œæˆã€‚

![](https://storage.googleapis.com/zenn-user-upload/prd3emwqmc17ykgme80txchb7fhn)

æ¬¡ã«build.gradleã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã€‚lets-plotã‚’è¿½åŠ ã™ã‚‹ã®ã«repositoriesã«mavenã®urlã¨jcenterãŒå¿…è¦ã«ãªã‚‹ã€‚

ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æŠ•ç¨¿æ™‚ç‚¹ã®ã‚‚ã®ãªã®ã§éšæ™‚èª¿ã¹ã¦æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚

```gradle:build.gradle
repositories {
    mavenCentral()
    maven {
        url "https://jetbrains.bintray.com/lets-plot-maven"
    }
    jcenter()
}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib"
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8"
    implementation "org.nd4j:nd4j-native-platform:0.9.1"
    implementation "org.jetbrains.lets-plot:lets-plot-common:1.5.2"
    implementation "org.jetbrains.lets-plot:lets-plot-batik:1.5.2"
    implementation "org.jetbrains.lets-plot:lets-plot-kotlin-api:1.0.0-rc1"
}
```

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã™ã‚‹

main.ktã‚’ä½œæˆã™ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/hao7ts5k6bizhbilje65hx61n6x9)

ãƒãƒ­ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰ï¼

```kotlin:main.kt
fun main(args: Array<String>) {
    println("Hello, world")
}
```

ç’°å¢ƒã®æº–å‚™ã¯æ•´ã£ãŸã®ã§å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã‚‹ã€‚

### è¡Œåˆ—è¨ˆç®—(ND4J)

[https://deeplearning4j.konduit.ai/nd4j/overview](https://deeplearning4j.konduit.ai/nd4j/overview)

JAVAã®è³‡æ–™ã ãŒã“ã®è¾ºã‚Šã‚’è¦‹ã‚Œã°ä½¿ãˆã‚‹ã€‚

```kotlin:main.kt
operator fun INDArray.plus(other: INDArray): INDArray = this.add(other)
operator fun INDArray.minus(other: INDArray): INDArray = this.sub(other)
operator fun INDArray.times(other: INDArray): INDArray = this.mmul(other)
operator fun INDArray.plus(other: Number): INDArray = this.add(other)
operator fun INDArray.minus(other: Number): INDArray = this.sub(other)
operator fun INDArray.times(other: Number): INDArray = this.mul(other)
operator fun INDArray.div(other: Number): INDArray = this.div(other)

fun matrixSample() {
    val a = Nd4j.create(doubleArrayOf(1.0,2.0,3.0,4.0), intArrayOf(2,2))
    val b = InvertMatrix.invert(a, false)
    println("a = \n$a")
    println("b = a^-1 = \n$b")
    println("a + b = \n${a + b}")
    println("a dot b = \n${a * b}")
}
```

ä¸Šã®ã‚µãƒ³ãƒ—ãƒ«ã¯é€†è¡Œåˆ—ã‚’æ±‚ã‚ã¦ç©ã‚’æ±‚ã‚ã‚‹ã‚‚ã®ã€‚å½“ç„¶å˜ä½è¡Œåˆ—ãŒæ±‚ã¾ã‚‹ã€‚

```
a = 
[[1.00,  2.00],  
 [3.00,  4.00]]
b = a^-1 = 
[[-2.00,  1.00],  
 [1.50,  -0.50]]
a + b = 
[[-1.00,  3.00],  
 [4.50,  3.50]]
a dot b = 
[[1.00,  0.00],  
 [0.00,  1.00]]
```
*çµæœ*

è¡Œåˆ—ã¯`Nd4j.create()`ã«`DoubleArray`ã‹`IntArray`è¾ºã‚Šã‚’æ¸¡ã™ã“ã¨ã§ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚ç¬¬1å¼•æ•°ãŒå€¤ã€ç¬¬2å¼•æ•°ãŒè¡Œåˆ—ã®å½¢ã€‚ãƒ™ã‚¯ãƒˆãƒ«ã¯`Nd4j.arange()`ã§Numpyã®ã‚ˆã†ã«ä½œã‚ŒãŸã‚Šã™ã‚‹ã€‚

INDArrayã¯æ¨™æº–ã ã¨operatorãŒä½¿ãˆãªã„ã®ã§ã€ä¸Šã®æ‹¡å¼µé–¢æ•°ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ç°¡æ½”ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹[^1]ã€‚

:::message
Nd4jã®[ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://deeplearning4j.org/api/latest/org/nd4j/linalg/factory/Nd4j.html)ã§ãªã‚“ã®é–¢æ•°ãŒã‚ã‚‹ã‹ç¢ºèªã§ãã‚‹ãŒã€ãªãœã‹ä½¿ãˆãªã„ã‚‚ã®ãŒã‚ã£ãŸã‚Š...
:::

### ã‚°ãƒ©ãƒ•è¡¨ç¤º

ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã«ã¯è‰²ã€…ã¨å¿…è¦ã€‚ä»¥ä¸‹ã‚’æº–å‚™ã™ã‚‹ã€‚JVMã§ã®æ›¸ãæ–¹ã¯

https://github.com/JetBrains/lets-plot-kotlin/issues/5

ã®issueãŒè©³ã—ã„ã®ã§é©å®œå‚ç…§ã€‚[ã‚ã‹ã‚Šã‚„ã™ã„å°å…¥](https://github.com/JetBrains/lets-plot-kotlin/blob/master/README_DEV.md)ã‚‚ã‚ã£ãŸã‚Šã€‚

```kotlin:main.kt
private val SVG_COMPONENT_FACTORY_BATIK =
    { svg: SvgSvgElement -> BatikMapperComponent(svg, BATIK_MESSAGE_CALLBACK) }

private val BATIK_MESSAGE_CALLBACK = object : BatikMessageCallback {
    override fun handleMessage(message: String) {
        println(message)
    }

    override fun handleException(e: Exception) {
        if (e is RuntimeException) {
            throw e
        }
        throw RuntimeException(e)
    }
}

private val AWT_EDT_EXECUTOR = { runnable: () -> Unit ->
    runnable.invoke()
}
```

ã¨ã‚Šã‚ãˆãšã‚µã‚¤ãƒ³ã‚«ãƒ¼ãƒ–ã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚

```kotlin:main.kt
fun plotSample() {
    SwingUtilities.invokeLater {

        val xArray = Nd4j.arange(0.0,60.0) / 10.0
        val yArray = Transforms.sin(xArray)
        val data = mapOf<String, Any>(
            "x" to xArray.data().asDouble(),
            "y" to yArray.data().asDouble(),
        )

        // ç·šã‚°ãƒ©ãƒ•ã‚’ã‹ã
        val geom = geom_line() {
            x = "x"
            y = "y"
        }
        val p = ggplot(data) + geom + ggtitle("sin")


        val plotSpec = p.toSpec()
        val plotSize = DoubleVector(1000.0, 1000.0)

        val component =
            MonolithicAwt.buildPlotFromRawSpecs(plotSpec, plotSize, SVG_COMPONENT_FACTORY_BATIK, AWT_EDT_EXECUTOR) {
                for (message in it) {
                    println("PLOT MESSAGE: $message")
                }
            }


        val frame = JFrame("ä¸‰è§’é–¢æ•°")
        frame.contentPane.add(component)
        frame.font = Font(Font.SANS_SERIF, Font.PLAIN, 10)
        frame.defaultCloseOperation = WindowConstants.EXIT_ON_CLOSE
        frame.pack()
        frame.isVisible = true
    }
}
```

![](https://storage.googleapis.com/zenn-user-upload/vkunnscv02ujp8nt9g2bxil0bxnd)
*çµæœ*

Nd4jã®arangeã¯ãªãœã‹å°æ•°åˆ»ã¿ãŒã§ããªã‹ã£ãŸã®ã§å‰²ã£ã¦è¡¨ç¾ã€‚ãã®å¾Œã¯Numpyã¨åŒæ§˜ã«sinã‚’è¨ˆç®—ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```kotlin
val xArray = Nd4j.arange(0.0,60.0) / 10.0
val yArray = Transforms.sin(xArray)
```

xã¨yã«ãã‚Œãã‚Œã‚’ä»£å…¥ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ã¤ãã‚‹ã€‚`INDArray.data().asDouble()`ã§è¡Œåˆ—ã‹ã‚‰å°æ•°é…åˆ—ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```kotlin
val data = mapOf<String, Any>(
    "x" to xArray.data().asDouble(),
    "y" to yArray.data().asDouble(),
)
// ç·šã‚°ãƒ©ãƒ•ã‚’ã‹ã
val geom = geom_line() {
    x = "x"
    y = "y"
}
val p = ggplot(data) + geom + ggtitle("sin")
```

è¤‡æ•°ã®ç·šã‚’å¼•ããŸã„å ´åˆã¯é…åˆ—ã‚’é€£çµã—ãŸä¸Šã§åŒºåˆ¥ç”¨ã®ãƒ©ãƒ™ãƒ«ã‚’ã¤ã‘ã‚‹ã¨ã†ã¾ãã„ãã€‚

```kotlin
val data = mapOf<String, Any>(
        "x" to xArray.data().asDouble() + xArray.data().asDouble(),
        "y" to yArray.data().asDouble() + (yArray * 0.5).data().asDouble(),
        "s" to List(xArray.size(1)) { "A" } + List(xArray.size(1)) { "B" }
)

val geom = geom_line() {
    x = "x"
    y = "y"
    color = "s"
}
```

![](https://storage.googleapis.com/zenn-user-upload/3ldc24ieae3l1d960hclksy0ilwr)
*ã‚°ãƒ©ãƒ•ã‚’è¤‡æ•°æã*

# çµ‚ã‚ã‚Šã«

- Kotlinã‹ãã‚„ã™ã„
- Javaã®è³‡ç”£ãŒä½¿ãˆã‚‹ã®ã§æ€ã£ãŸã‚ˆã‚Šè‰²ã€…ã§ãã‚‹
- è¡Œåˆ—ã‚’æ‰±ã†ã¨ã‚¨ãƒ©ãƒ¼åãã®ãŒå®Ÿè¡Œæ™‚ã«ãªã‚‹ãŸã‚å‹ãŒå³æ ¼ã§ã‚ã‚‹ã“ã¨ã®æ©æµã¯ã‚ã¾ã‚Šãªã„...?
	- PythonãŒäººæ°—ãªã®ã‚‚é ·ã‘ã‚‹
- ãã‚Œã§ã‚‚ã‹ãã‚„ã™ã„

ä»Šå›ã®å…¨ä½“ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã€‚

https://gist.github.com/organic-nailer/35fb3eb42ae601e464056201e7f70a90



[^1]: [ã“ã“](https://qiita.com/alchemist/items/ac11e6a926288129de2d)ã‚’å‚è€ƒã€‚

# å‚è€ƒ
- [NumPyã¿ãŸã„ãªæ•°å€¤è¨ˆç®—ã‚’Kotlin+ND4Jã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ - Qiita](https://qiita.com/alchemist/items/ac11e6a926288129de2d)
- [Jupyter Notebookã§KotlinãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§è§¦ã£ã¦ã¿ãŸ - Qiita](https://qiita.com/tommykw/items/2a4d3fe40350038f5216)
- https://github.com/JetBrains/lets-plot-kotlin/issues/5
- https://github.com/JetBrains/lets-plot-kotlin/blob/master/README_DEV.md
- https://github.com/JetBrains/lets-plot-kotlin/blob/master/demo/jvm-batik/src/main/kotlin/minimalDemo/Main.kt
- https://github.com/JetBrains/lets-plot-kotlin/blob/master/docs/examples.md
- https://nbviewer.jupyter.org/github/JetBrains/lets-plot-kotlin/blob/master/docs/examples/jupyter-notebooks/legend_and_axis.ipynb
- https://github.com/JetBrains/lets-plot-kotlin


# ãã®ä»–
- https://github.com/thomasnield/kotlin-data-science-resources
- https://kotlinlang.org/docs/reference/data-science-overview.html